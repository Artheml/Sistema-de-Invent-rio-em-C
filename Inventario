//criar um sistema de controle de inventário de uma loja.
//Funções: o usuário poder cadastrar um novo produto, qtd e preço.Os dados precisam serem armazandosos em um arquivo chamado invetario_loja.csv
//consultar informaçõs do produto com o usuário inserindo o nome do produto.
//o sistema deve ler o arquivo invetario_loja.csv e exibir a lista de todos os produtos cadastrados
//permitir que o usuário saia do programa

#include<stdio.h>
#include<stdlib.h>
#include<string.h>

#define MAX_NAME_LENGTH 50
#define FILE_CSV "inventario_loja.csv"

typedef struct{
    char nome[MAX_NAME_LENGTH];
    int quantidade;
    float preco;
    
} Produto;

 void cadastrar_produto() {
    Produto produto;
    
    printf("Digite o nome do produto: ");
    scanf("%s", produto.nome);
    printf("Digite a quantidade do produto: ");
    scanf("%d",&produto.quantidade);
    printf("Digite o preço do produto: ");
    scanf("%f",&produto.preco);
    

    FILE*file = fopen(FILE_CSV, "a"); //abre o arquivo csv em modo append para adcionar os dados no final do arquivo
    if (file == NULL);
        printf("Erro ao abrir o arquivo. \n");
        return;
    }

    fprintf(file, "%s,%d,%.2f\n", produto.nome, produto.quantidade, produto.preco); //para retornar o valor negativo se ocasionar erro de saída
    fclose(file);
    printf("Produto cadastrado com sucesso!\n");

}

void mostrar_produto(){
    FILE *file = ofopen(CSV_FILE,"r");
    if (file == NULL){
        printf("Nenhum Produto cadastrado. \n");
        return;
        
    }
    
    char linha[300];
    printf("\nLista dos pordutos cadastrados:\n");
    while (fgets(linha, sizeof(linha),file)){   //funcao para ler cada linha do arquivo e imprimir os dados
        printf("%s", linha);
    }
    
    fclose(file);
    
}

void consultar_produto(){
    char nome[MAX_PRODUTO_LENGTH];
    printf("Digite o nome do produto que deseja consultar: ");
    scanf("%s", nome);
    
    FILE *file = fopen(CSV_FILE,"r");
    if(file ==NULL){
        printf("Nnehum produtro cadastrado.");
        return;
    }
    
char linha[300];
int encontrar = 0;
while (fgets(linha, sizeof(linha),file)){
    char nome_produto[MAX_PRODUTO_LENGTH];
    sscanf(linha, "%[^,],", nome_produto); //funcao para ler linha por linha e extrair o nome do produto
    if(strcmp(nome_produto, nome)==0){  //para comparar o nome inserido pelo usuario com o nome do produto
        printf("Produto encontrado: %s", linha);
        encontrar =1;
        break;
    }
}

if (encontrar){
    printf("Produto não encontrado.\n");

    }

    fclose(file);

}

int main(){
    int escolha;
    
    while(1){
        printf("---------Bem vindo ao Sistema de Inventário da Juju!---------"):
        printf("\n\nEscolha uma opção:");
        scanf("%d", &escolha);
        printf("1. Cadastrar produto.\n");
        printf("2. Ler produtos.\n");
        printf("3. Consultar produto.\n");
        printf("4.Sair.\n");
        
        switch(escolha){
          case 1:
            cadastrar_produto();
            break;
            
          case 2:
            mostrar_produto();
            break;
            
          case 3:
            consultar_produto();
            break;
            
          case 4:
            printf("Saindo do sistema... \n");
            return 0;
          default:
            printf("Opção inválida! Tente novamente.\n");

        }
        
        
    }
    
    return 0;
}
    


